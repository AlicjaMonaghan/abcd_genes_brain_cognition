**Code repository for "Population-Level Genetic Variation Shapes Generative Brain Mechanisms".**

Alicja Monaghan [1,2], Danyal Akarca [1] & Duncan Astle [1,3]
1. MRC Cognition and Brain Sciences Unit, University of Cambridge, Cambridge, UK
2. The Alan Turing Institute, London, UK
3. Department of Psychiatry, University of Cambridge, Cambridge, UK

For any questions about the use of this repository, please contact Alicja.Monaghan@mrc-cbu.cam.ac.uk.

**Requirements**

The following installations are required to use all the attached scripts. 
* MATLAB 2022a (installation: https://uk.mathworks.com/help/install/install-products.html)
* RStudio 2022.12.0.353 (installation: https://rstudio.com/products/rstudio/download/)
* Brain Connectivity Toolbox 2019 (installation: https://sites.google.com/site/bctnet/)
* Cytoscape v3.9.1 (installation: https://cytoscape.org/download.html)
* Distance-dependent consensus thresholding toolbox: Betzel, R. F., Griffa, A., Hagmann, P., & Mišić, B. (2019). Distance-dependent consensus thresholds for generating group-representative structural brain networks. Network neuroscience, 3(2), 475-496.

To be compatible with our scripts, save the toolboxes in a folder called /toolboxes_and_functions, inside the saved directory.

**ABCD Data Availability**

This work uses open-access neuroimaging, genetic, and cognitive data from 2154 children from the baseline time point of the Adolescent Brain Cognitive Development (ABCD) study, Release 4 (http://dx.doi.org/10.15154/1523041). Access to ABCD can be requested here: https://nda.nih.gov/nda/access-data-info.html.

**Manuscript Data**

To reproduce our results, we provide the following derived data through OSF: structural connectomes generated by deterministic tractography in QSIprep 0.15.3 (Cieslak et al., 2021), framewise displacement from QSIprep, age in months, sex, site ID, polygenic scores for cognitive ability (calculated using a tutorial from Choi and colleagues, 2020, Nature Protocols, 15, 2759-2772), general g factor of cognitive ability (derived from a principal component analysis of 7 NIH Toolbox cognitive assessements of working memory, attention, executive function, and language). Note that all data from ABCD is anonymised, and no subject IDs are included. We've also undertaken additional anonymisation steps, such as recoding 
scanner site. Available on request to researchers with a NIH DUA. 

We also include the Cytoscape session used to visualise comparative enrichment gene ontology tests. This contains two annotation sets. The first is the original node names/groupings, whilst the second is the version visualised in the manuscript. 

**/Scripts**
1. threshold_and_binarise.m
2. run_and_evaluate_group_gnm.m
3. run_individual_neighbours_structural_gnm_grid_search.m
4. examine_individual_neighbours_structural_gnm_outputs.m
5. pgs_group_visualisation.R
6. run_pls_regression_ahba_nodal_parameters.m
7. sorting_pls_regression_ahba_nodal_parameters.m
8. linking_ahba_genetics_with_gnm_parameters_and_cognition.m
9. abcd_gene_ontology_analysis.R
10. abcd_group_and_individual_gnm_visualisation.R
11. fcn_ks.m --> This calculates the Kolmogorv-Smirnov statistic comparing distributions of degree, total edge length, betweeenness-centrality, and clustering, used to calculate energy. This script was written by Dr. Danyal Akarca. Add this to the /toolboxes_and_function path when downloading this directory.
